#:kivy 2.0

<StatusBarWidget>:
    canvas:
        Rectangle:
            size: self.size
            pos: self.pos
            source: self._background_image

    spacing: 1
    rows: 1
    cols: 4
    _battery_image: _battery_image
    _battery_label: _battery_label
    _wifi_image: _wifi_image
    _state_image: _state_image
    _speed_image: _speed_image
    _speed_label: _speed_label
    size_hint: 1, 1
    # (r:1, c:1)
    BoxLayout:
        size_hint: 1, 1
        pos_hint: {"center_x": 0.5, "center_y":0.5}
        Image:
            id: _state_image
            name: "state_image"
            size_hint: 1, 1
            pos_hint: {"center_x": 0.5, "center_y":0.5}
            orientation: "horizontal"


# (r:1, c:2)
    BoxLayout:
        size_hint: 1, 1
        pos_hint: {"center_x": 0.5, "center_y":0.5}
        orientation: "vertical"
        StatusBarWidgetImage:
            id: _speed_image
            name: "speed_image"
            size_hint: 1, 1
            pos_hint: {"center_x": 0.5, "center_y":0.5}

        Label:
            id: _speed_label
            name: "speed_label"
            size_hint: 1,1
            pos_hint: {"center_x": 0.5, "center_y":0.5}
            text:"[b]15[/b] \r[i]cm/s[/i]"
            markup: True


    # (r:1, c:3)
    FloatLayout:
        size_hint: 1, 1
        pos_hint: {"center_x": 0.5, "center_y":0.5}
        StatusBarWidgetImage:
            id: _battery_image
            name: "battery_image"
            pos_hint: {"center_x": 0.5, "center_y":0.5}
            on_release: self.parent.parent.on_image_press(self.name)
        Label:
            id: _battery_label
            name: "battery_label"
            size_hint: 1,0.2
            pos_hint: {"center_x": 0.5, "center_y":0.5}
            text:"[b]  15%[/b]"
            markup: True

    # (r:1, c:4)
    BoxLayout:
        size_hint: 1, 1
        pos_hint: {"center_x": 0.5, "center_y":0.5}
        StatusBarWidgetImage:
            id: _wifi_image
            name: "wifi_image"
            pos: self.pos
            size: self.size
            on_release: self.parent.parent.on_image_press(self.name)


<BunnyWidget>:
    pos: self.pos
    size: self.size
    canvas.before:
        PushMatrix
        Rotate:
            angle: self.angle
            axis: 0, 0, 1
            origin: self.center
    canvas.after:
        PopMatrix

<RadioDongleWidget>:
    _wifi_image: _wifi_image
    _spinner: _spinner
    _search_button: _search_button
    _connect_button: _connect_button

    size_hint: 1, 1
    orientation: "horizontal"
    # Wifi Image
    Image:
        id: _wifi_image
        size_hint: 0.3, 1
        pos_hint: {"center_x": 0.5, "center_y":0.5}
    # Radio Options Spinner
    Spinner:
        id: _spinner
        size_hint: 1, 1
        markup: True
        size_hint: 1, 1
        font_size: '16sp'
        pos_hint: {"left": 1}

    GridLayout:
        rows: 2
        cols: 1
        size_hint: (1, 1)
        Button:
            id: _search_button
            size_hint: 1, 1
            text: "[b][i]Search[/i][/b]"
            markup: True
            font_size: '17sp'
        Button:
            id: _connect_button
            size_hint: 1, 1
            text: "[b][i]Connect[i][/b]"
            font_size: '17sp'
            markup: True

<BunnyActionBar>:

    ActionView:
        ActionPrevious:
            title: "Connection Status"
            with_previous: False

        ActionButton:
            text: "Connected"
        
        ActionButton:
            text: "State"
        
<DragAndResizeTriangle>:
    # Triangle Definitions
    drag_rectangle: self.x, self.y, self.width, self.height
    drag_timeout: 1000000
    drag_distance: 0
    canvas.after:
        Color:
            rgba: 0,0,0,0
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba: self.border_color
        Triangle:
            points:self.triangle_points

        Line:
            cap: "square"
            joint: "miter"
            width: self.border_width
            points: self.border_points


<DragAndResizeRect>:
    # drag definitions
    drag_rectangle: self.x, self.y, self.width, self.height
    drag_timeout: 10000000
    drag_distance: 0
    canvas.after:
        Color:
            rgba: self.fill_color
        Rectangle:
            size: self.size
            pos: self.pos
        
        Color:
            rgba: self.border_color
        Line:
            cap: "square"
            joint: 'miter'
            width: self._border_width
            rectangle: self._border_coord
                      

<DragAndResizePolygon>:
    # drag definitions
    drag_rectangle: self.x, self.y, self.width, self.height
    drag_timeout: 10000000
    drag_distance: 0

    canvas.after:
        Color: 
            rgba: self.fill_color
        Ellipse:
            pos: self.pos
            size: self.size
            segments: self.segments
        Color:
            rgba: self.border_color
        Line:
            points: self.line_points
            width: self.border_width


<GridWidget>:


<ColorDropDown>:
    red_slider: _red_slider
    green_slider: _green_slider
    blue_slider: _blue_slider
    transparency_slider: _transparency_slider
    none_button: _none_button


    Slider:
        id: _red_slider
        min: 0
        max: 1
        step: 0.1
        orientation: "horizontal"
        size_hint_y: None
        height: '20dp'
        cursor_height: '12sp'
        cursor_width: '12sp'
        
        canvas.before:
            Color: 
                rgba: 1, 0, 0, 1
            Rectangle:
                pos: self.pos
                size: self.size

    Slider:
        id: _green_slider
        min: 0
        max: 1
        step: 0.1
        orientation: "horizontal"
        size_hint_y: None
        height: '20dp'
        cursor_width: '12sp'
        cursor_height: '12sp'
        canvas.before:
            Color: 
                rgba: 0, 1, 0, 1
            Rectangle:
                pos: self.pos
                size: self.size

    Slider:
        id: _blue_slider
        min: 0
        max: 1
        step: 0.1
        orientation: "horizontal"
        size_hint_y: None
        height: '20dp'
        cursor_width: '12sp'
        cursor_height: '12sp'
        canvas.before:
            Color: 
                rgba: 0, 0, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size

    Slider:
        id: _transparency_slider
        min: 0
        max: 1
        step: 0.1
        orientation: "horizontal"
        size_hint_y: None
        height: '20dp'
        cursor_width: '12sp'
        cursor_height: '12sp'
        canvas.before:
            Color: 
                rgba: 1, 1, 1, 0.2
            Rectangle:
                pos: self.pos
                size: self.size
    Button:
        id: _none_button
        size_hint_y: None
        height: '25dp'
        text: "[i]None[/i]"
        font_size: 12
        markup: True


<ShapeSettings>:
    
    _shape_label: _shape_label
    _shape_spinner: _shape_spinner
    
    _fill_color_label: _fill_color_label
    _fill_color_button: _fill_color_button 

    _type_label: _type_label
    _type_spinner: _type_spinner

    _border_color_label: _border_color_label
    _border_color_button: _border_color_button


    _lock_size_label: _lock_size_label
    _lock_size_checkbox: _lock_size_checkbox

    _lock_position_label: _lock_position_label
    _lock_position_checkbox: _lock_position_checkbox
    
    _place_button: _place_button
    _new_button: _new_button

    cols: 6
    row_force_default: True
    row_default_height: 30
    spacing: 2

    
    #(r1, c1)
    Label:
        id: _shape_label
        text: "Shape"
        markup: True
        font_size: self.parent._label_font_size
        canvas.before:
            Color:
                rgba: self.parent._bkg_color
            Rectangle:
                pos: self.pos
                size: self.size

    #(r1, c2)
    Spinner:
        id: _shape_spinner
        text: "Rectangle"
        values: ["Rectangle","Polygon","Ellipse"]
        sync_height: True
    
    #(r1, c3)
    Label:
        id: _fill_color_label
        text: "Fill"
        markup: True
        font_size: self.parent._label_font_size
        canvas.before:
            Color:
                rgba: self.parent._bkg_color
            Rectangle:
                pos: self.pos
                size: self.size

    #(r1, c4)
    Button:
        id: _fill_color_button
        markup: True
        font_size: 12
        background_color: 0, 0, 0, 1
        canvas:
            Color:
                rgba: self.parent._shape_fill_color
            Rectangle:
                pos: self.pos
                size: self.size

    #(r1, c5)
    Label:
        id: _type_label
        text: "Type"
        font_size: self.parent._label_font_size
        canvas.before:
            Color: 
                rgba: self.parent._bkg_color
            Rectangle:
                pos: self.pos
                size: self.size
    
    #(r1, c6)
    Spinner: 
        id: _type_spinner
        text: "Border"
        values: ["Border", "Obstacle"]
        canvas.before:
            Color:
                rgba: self.parent._bkg_color
            Rectangle:
                pos: self.pos
                size: self.size
        sync_height: True


    #(r2, c1)
    Label:
        id: _border_color_label
        text: "Border "
        font_size: self.parent._label_font_size
        pos: self.pos
        size: self.size
        canvas.before:
            Color:
                rgba: self.parent._bkg_color
            Rectangle:
                pos: self.pos
                size: self.size

    #(r2, c2)
    Button: 
        id: _border_color_button
        markup: True
        font_size: 12
        background_color: 0, 0, 0, 1
        canvas:
            Color:
                rgba: self.parent._shape_border_color
            Rectangle:
                pos: self.pos
                size: self.size
        
    #(r2, c3)
    Label:
        id: _lock_size_label
        text: "Lock Size"
        font_size: self.parent._label_font_size
        canvas.before:
            Color:
                rgba: self.parent._bkg_color
            Rectangle:
                pos: self.pos
                size: self.size
    
    #(r2, c4)
    CheckBox:
        id: _lock_size_checkbox
        color: 1, 1, 1, 1
        canvas.before:
            Color: 
                rgba: 0, 0, 0, 1
            Rectangle:
                pos: self.pos
                size: self.size

    #(r2, c5)
    Label:
        id: _lock_position_label
        text: "Lock Pos"
        font_size: self.parent._label_font_size
        canvas.before:
            Color:
                rgba: self.parent._bkg_color
            Rectangle:
                pos: self.pos
                size: self.size

    #(r2, c6)
    CheckBox:
        id: _lock_position_checkbox
        color: 1, 1, 1, 1
        canvas.before:
            Color:
                rgba: 0, 0, 0, 1
            Rectangle:
                pos: self.pos
                size: self.size
    #(r3, c1)
    Button:
        id: _place_button
        text: "Place"
        pos: self.pos
        size: self.size
    
    #(r3, c2)
    Button:
        id: _new_button
        text: "New"
        canvas.before:
            Color:
                rgba: self.parent._bkg_color
            Rectangle:
                pos: self.pos
                size: self.size


<ScaleSettings>:
    max_length_label: max_length_label
    text_input_wid: text_input_wid
    cols: 2
    Label:
        id: max_length_label
        text: "Maximum Length [m]"
        canvas.before:
            Color:
                rgba: 0, 0, 0, 1
            Rectangle: 
                pos: self.pos
                size: self.size
        
    TextInput:
        id: text_input_wid
        text: "15"
        multiline: False
        input_filter: "float"


#======= Choreography Widgets =====================#
<SelectableBoxLayout>:
    orientation: "horizontal"
    canvas.before:
        Color: 
            rgba: (0, 1, .7, 1) 
        Rectangle:
            pos: self.x + self.starting_x*self.width, self.y
            size: (self.line_pos_x+ self.starting_x)*self.width, self.height
        Color:
            rgba: 0,0,0,1
        
        Rectangle:
            pos: self.x + (self.line_pos_x+self.starting_x)*self.width, self.y
            size: (1 - (self.line_pos_x + self.starting_x))*self.width, self.height
        
        Color:
            rgba: 0, 0, 0, 1
        Line:
            points: self.x + (self.starting_x + self.line_pos_x)*self.width, self.y, self.x + (self.line_pos_x+self.starting_x)*self.width, self.y+self.height
            width: 2
        
        Color:
            rgba: self.border_color if self.selected else (0,1,1,0)
        Line:
            rectangle: self.x, self.y, self.width, self.height
            width: 2
    
    Label:
        size_hint: 0.2, 1
        pos_hint: {"top": 1}
        text: self.parent.text


<AnimationSelection>:
    viewclass: 'SelectableBoxLayout'
    SelectableRecycleBoxLayout:
        default_size: None, dp(40)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        multiselect: False
        touch_multiselect: True
        spacing: 3

<ChoreoBoard>:
    orientation: "vertical"
    padding: 5
    spacing: 5
    background_color: 0,0,0,1
    animation_selection: choreography_pane
    GridLayout:
        size_hint: 1, 0.2
        cols: 4
        Button:
            id: square_btn
            text: "Rectangle"
            canvas:
        Button:
            id: ellipse_btn
            text: "Ellipse"

        Button:
            id: cirle_btn
            text: "Circle"

        Button:
            id: line_btn
            text: "Triangle"

    BoxLayout:
        pos_hint: {"top": 1}
        size_hint: 1, 0.1
        orientation: "horizontal"
        pos_hint: {"top":1}
        Spinner:
            id: choice_spinner
            size_hint: 0.8, 1
            text: "Rotate"
            padding_x: 5
            pos_hint: {"left": 1}
            values: ["Rotate", "Morph"]
            canvas.before:
                Color: 
                    rgb: 0,0,0
                Rectangle:
                    size: self.size
                    pos: self.pos
        Label:
            text: "Type"
            size_hint: 0.5, 1
            pos_hint: {"left":1}
            canvas.before:
                Color:
                    rgb: 0, 0.4, 0.8
                Rectangle:
                    size: self.size
                    pos: self.pos        
        Spinner:
            size_hint: 0.8, 1
            text: "shape"
            multiline: False
            values: ["along line", "shape"]
            sync_height: True
            disabled: True if choice_spinner.text == "Morph" else False

    BoxLayout:
        orientation: "horizontal"
        size_hint: 1, 0.1
        pos_hint: {"top": 1}
        Button:
            id: add_btn
            text: "Add to canvas"
        Button:
            id: reset_btn
            text: "Reset"
    
    BoxLayout:
        size_hint: 1, 0.1
        pos_hint: {"top": 1}
        orientation: "horizontal"
        Label:
            padding: 20, 1
            size_hint: 0.3, 1
            text: "Angle" if choice_spinner.text == "Rotate" else "Expansion"
            canvas.before:
                Color:
                    rgba: 0,0,0,1
                Rectangle:
                    pos: self.pos
                    size: self.size
        Label:
            size_hint: 0.2, 1
            text: str(value_slider.value)
            canvas.before:
                Color:
                    rgba: 0,0,0,1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Slider:
            id: value_slider
            min:-360 if choice_spinner.text == "Rotate" else -1
            max: 360 if choice_spinner.text == "Rotate" else 5
            step: 45 if choice_spinner.text == "Rotate" else 0.5
            orientation: "horizontal"
            value_track_color: 1,0,0,1
            value_track: True
    BoxLayout:
        size_hint: 1, 0.1
        pos_hint: {"top": 1}
        orientation: "horizontal"
        Label:
            size_hint: 0.35, 1
            text: "Start After"
            canvas.before:
                Color:
                    rgba: 0,0,0,1
                Rectangle:
                    size: self.size
                    pos: self.pos
        Label:
            size_hint: 0.15, 1
            text: str(start_after_slider.value)
            canvas.before:
                Color:
                    rgba: 0,0,0,1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Slider:
            id: start_after_slider
            min: 0
            orientation: "horizontal"
            value_track_color: 1, 0, 0, 1
            value_track: True 
            step: 0.5
        


    BoxLayout:
        size_hint: 1, 1
        pos_hint: {"top": 1}
        AnimationSelection:
            id: choreography_pane
            canvas.before:
                Color:
                    rgba: 0,0,0,1
                Rectangle:
                    pos: self.pos
                    size: self.size


    BoxLayout:
        size_hint: 1, 0.08
        pos_hint: {"top": 1}
        orientation: "horizontal"
        Button:
            id: simulate_btn
            text: "Simulate"

        Button:
            id: delete_btn
            text: "Delete"
            on_release: choreography_pane.delete_entry(self)
        
        Button:
            id: preview_btn
            text: "Preview"


<ChoreoRect>:
    drag_rectangle: self.x, self.y, self.width, self.height
    drag_timeout: 10000000
    drag_distance: 0
    canvas.before:
        PushMatrix
        Rotate:
            angle: self.angle
            origin: self.center[0]-self.border_width, self.center[1] - self.border_width
        Color:
            rgba: 0,0,0,0
        Rectangle:
            size: self.size
            pos: self.pos
       
        Color:
            rgba: self.n_border_color
        Line:
            points: self.n_border_points
            width: self.border_width
    canvas.after:
        PopMatrix
        Color:
            rgba: self.c_border_color
        Line:
            points: self.x-self.border_width, self.y-self.border_width, self.x-self.border_width + self.width, self.y-self.border_width, self.x+self.width-self.border_width, self.y + self.height-self.border_width, self.x-self.border_width, self.y + self.height-self.border_width, self.x-self.border_width, self.y-self.border_width
            width: self.border_width
        
<ChoreoPolygon>:
    # drag definitions
    drag_rectangle: self.x, self.y, self.width, self.height
    drag_timeout: 10000000
    drag_distance: 0
    canvas.before:
        PushMatrix
        Rotate:
            angle: self.angle
            origin: self.center[0]-self.border_width, self.center[1] - self.border_width
        Color:
            rgba: 0,0,0,0
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba: self.n_border_color
        Line:
            points: self.n_border_points
            width: self.border_width

    canvas.after:
        PopMatrix
        Color:
            rgba: self.c_border_color
        Line:
            points: self.line_points
            width: self.border_width


<ChoreoTriangle>:
    drag_rectangle: self.x, self.y, self.width, self.height
    drag_timeout: 10000000
    drag_distance: 0
    canvas.before:
        PushMatrix
        Rotate:
            angle: self.angle
            origin: self.center[0]-self.border_width, self.center[1] - self.border_width
        Color:
            rgba: 0,0,0,0
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba: self.n_border_color
        Line:
            points: self.n_border_points
            width: self.border_width

    canvas.after:
        PopMatrix
        Color:
            rgba: self.c_border_color
        Line:
            points: self.line_points
            width: self.border_width
